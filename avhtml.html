<!DOCTYPE html>
<html>
    <head>
        <title>Danish GPA Calculator</title>
        <style type="text/CSS">
            h1 {
                float: center;
                font-style: italic;
            }
            table{
                margin-left: auto;
                margin-right: auto;
                float: center;
                font-weight: bold;
            }
            input{
                float: center;
                font-weight: bold;
            }
            div {
                display: block;
                /* float:center; */
                margin-left: auto;
                margin-right: auto;
                resize:none;
                /* overflow:hidden; */
            }
            p {
                padding: 0;
                margin: 10px;
                text-align:center;
            }
        </style>
    </head>
    <body>
        <h1>
            <i>
                <center>Translating grades into the Danish grading system (7 point)</center>
            </i>
        </h1>
        <div class="col-lg-6">
            <div>
                <b>The Highest Grade of Your Grading System:</b>
                </br>
                <input type="number" id="highest" placeholder="Required">
            </div>
            <div>
                <b>The Lowest Grade of Your Grading System:</b>
                </br>
                <input type="number" id="lowest" placeholder="Required">
            </div>
        </div>
        <table class="col-lg-6">
            <tr>
                <td>
                    Subject Name:
                </td>
                <td>
                    <input type="text" id="subjectName" placeholder="Required">
                </td>
            </tr>
            <tr>
                <td>
                    Course Type:
                </td>
                <td>
                    <select id="select" required>
                        <option value='' disabled selected hidden>Select Your Course Type</option>
                        <option value='1'>With grades given as digits</option>
                        <option id='pass' value="2">With 'Passed' or 'Not passed'</option>
                        <option id='thesis' value="3">Grade for BSc or MSc thesis</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Grade:
                </td>
                <td>
                    <div id='scoreDiv' style="display: inline-block">
                        <input type="number" id="score" placeholder="Required">
                    </div>
                    <div id='passScoreDiv' style="display: none">
                        <select id='passScore'>
                            <option value="Passed">Passed</option>
                            <option value="Not passed">Not passed</option>
                        </select>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    Credit:
                </td>
                <td>
                    <input type="weight" id="weight" placeholder="Required">
                </td>
            </tr>
            <tr>
                <td>
                    Total Credit:
                </td>
                <td>
                    <input type="number" id="creditTotal" disabled>
                </td>
            </tr>
            <tr>
                <td>
                    <input type="button" id="btnAdd" value="Add">
                </td>
                <td>
                    <input type="button" id="btnClear" value="Clear All">
                </td>
            </tr> 
        </table> 
        <div style="float: right;margin-right: 40%;width: 400px">
            <table style="text-align:center;width: 160%;" border="1">
                <caption style = 'width: 100%;'>
                    <h2><b>Courses with grades given as digits</b></h2>
                </caption>
                <tr>
                    <th style="width:20%">
                        Subject name
                    </th>
                    <th style="width:20%">
                        Grade
                    </th>
                    <th style="width:20%">
                        Credits
                    </th>
                    <th style="width:20%">
                        Credits * grade
                    </th>
                    <th style="width:20%">
                        Tools
                    </th>
                </tr>
                <tbody id="board1">
                </tbody>
                <tr id="tsum">
                </tr>
            </table>      
            <div>
                <b>Danish Weighted Average:</b>
                <input type="number" id="average1" disabled>   
            </div>
                                <!-- //table 2 -->
            <table style="text-align:center;width: 160%;" border="1">
                <caption style = 'width: 100%;'>
                    <h2><b>Courses with 'Passed' or 'Not passed' grades</b></h2>
                </caption>
                
                <tr>
                    <th style="width:20%">
                        Subject name
                    </th>
                    <th style="width:20%">
                        Grade
                    </th>
                    <th style="width:20%">
                        Credits
                    </th>
                    <th style="width:20%">
                        Tools
                    </th>
                </tr>
                <tbody id="board2">
                </tbody>
                <tr id="tsum2">
                </tr>
            </table>      
            <div  style="width:600px;">
                <b>Percentage Courses with the grade “Passed”:</b>
                <input type="number" id="average2" disabled><b>%</b>
            </div>
                               <!-- //table 3 -->
            <table style="text-align:center;width: 160%;" border="1">
                <caption style = 'width: 100%;'>
                    <h2><b>Grade for BSc or MSc thesis</b></h2>
                </caption>
                
                <tr>
                    <th style="width:20%">
                        Subject name
                    </th>
                    <th style="width:20%">
                        Grade
                    </th>
                    <th style="width:20%">
                        Credits
                    </th>
                    <th style="width:20%">
                        Tools
                    </th>
                </tr>
                <tbody id="board3">
                </tbody>
                <tr id="tsum3">
                </tr>
            </table>
            <div>
                <b>Grade for BSc or MSc thesis:</b>
                <input type="number" id="average3" disabled>   
            </div>

        </div>
        
        <div style="background-color:#98AFC7;float: right;padding: 50px">
            <h2>How to fill in</h2>
            <h3>NB! Please read the information below carefully</h3>
            <ul>
                <li>Please fill in one form for your bachelor's degree and one for your master's degree.</li>
                <li>You must enter the highest grade in the grading system of your home university, even if you have not received this grade for any of the courses you are listing.</li>
                <li>It is very important that you enter the lowest passing grade in the grading system of your home university, not the lowest grade you received.</li>
                <li>Grades given as letters, A, B, C etc., cannot be converted. Instead you should enclose an official description of your university's grading system.</li>
                <li>Credits may be listed either as points, hours, or whichever quantification method used to calculate the estimated time spent on coursework. </li>
                <li>If all courses weigh the same, i.e. are each worth the same amount of credits, just enter 1 in each field under Credits</li>
                <li>Please do not include your thesis grade in the conversion, as it may influence your grade point average disproportionately in a positive or negative manner. Please list this grade in the designated field below.</li>
            </ul>
        </div>
        <script type="text/javascript">
            var $ = function (id){
                return document.getElementById(id);
            }
            window.onload = function(){
                $('btnAdd').onclick = addToArray;
                $('btnClear').onclick= clearAll;
            }
            $('select').addEventListener('change',function(){ 
                if($('select').value==='2'){
                    $('scoreDiv').style.display='none'
                    $('passScoreDiv').style.display='inline-block'           
                }else{
                    $('scoreDiv').style.display='inline-block'
                    $('passScoreDiv').style.display='none'        
                }
            })
            
            const s=$('score'), w=$('weight'), n=$('subjectName'),h=$('highest'),l=$('lowest');
            [s,w,n,h,l].forEach(element => 
                element.addEventListener('keypress', function(event){
                    if(event.key==='Enter'){
                        $('btnAdd').click();
                    }
                })
            ); //you can do this for the whole document/each element/an array of them

            var highest, lowest, per, tarray=[];
            let scores={
                1:[],
                2:[],
                3:[]
            }
            let credits={
                1:[],
                2:[],
                3:[],
            }
            let creditTotal = [0,0,0] 
            function addToArray (){       
                var a=parseInt($('select').value) ;   
                
                highest=parseFloat($('highest').value)
                if(!isNaN(highest)){
                    $('highest').disabled=true;
                }else {
                    alert('Please Enter The Highest Grade of Your Grading System');
                    $('highest').focus();
                    return
                };
                lowest=parseFloat($('lowest').value)
                if(!isNaN(lowest)&&lowest<highest){
                    $('lowest').disabled=true;
                }else{
                    alert('Please Enter The Lowest Grade of Your Grading System');
                    $('lowest').focus();
                    return
                }
                var weight=parseFloat($('weight').value);
                if ((weight)==null||isNaN(weight) || (weight) <0){
                    alert('Please enter a valid number for credits ');
                    $('weight').focus();
                    return
                }
                subjectName = $('subjectName').value
                if (!(subjectName)){
                    alert('Please enter a course name');
                    $('subjectName').focus();
                    return
                }
                credits[a].push(weight)
                if(a==1 || a==3){
                    var score = parseFloat($('score').value);
                        if (isNaN(score) || score>highest){
                            alert('Please enter a valid score between equal or less than the '+ highest);
                            $('score').focus();
                            return
                        }
                    if(a==3) {$('thesis').disabled=true;$('thesis').selected=false;}
                }else if(a==2){
                    score = $('passScore').value
                }
                scores[a].push(score)
                updateTables(a)
                display(a);
            }
            function getSum(total, num){
                return total+num;
            }

            function updateTables(a){
                creditTotal[a-1] = credits[a].reduce(getSum);
                if(a==1){
                    for(i=0;i<scores[a].length;i++){
                        tarray[i]=scores[a][i]*credits[a][i];
                    }
                    scoreTotal = tarray.reduce(getSum);
                    average = Math.round(((scoreTotal / creditTotal[a-1]-lowest)/(highest-lowest)*10+2)*10)/10; 
                    $('average1').value  = average
                    sum()
                }else if(a==2){
                    per=0;
                    for(i=0;i<scores[a].length;i++){
                        if(scores[a][i]=='Passed') per+=credits[a][i]
                    }
                    passAverage=per/creditTotal[a-1];
                    $('average2').value=Math.round(passAverage*10000)/100;
                }else if(a==3){
                    thesis=(scores[a][0]-lowest)/(highest-lowest)*10+2;
                    thesis=Math.round(thesis*100)/100;
                    $('average3').value=thesis;
                }
                $('creditTotal').value = creditTotal.reduce(getSum);
            }
            function refresh(){
                $('score').value='';$('weight').value='';$('subjectName').value = '';$('subjectName').focus();
            }
            function clearInputs(a){
                refresh()
                $('average'+a).value = '';
                $('board'+a).innerHTML = '';
                scores[a]=[], credits[a]=[],creditTotal[a-1]=0
                if(a==1){
                    $('tsum').innerHTML = '';
                    tarray=[]
                }else if(a==3){
                    $('thesis').disabled=false;$('thesis').selected=false
                }
                $('creditTotal').value = creditTotal.reduce(getSum)
            }
            function clearAll(){
                clearInputs(1);clearInputs(2);clearInputs(3);
                $('highest').value=$('lowest').value=''
                $('highest').disabled=false;$('lowest').disabled=false;
            }
            function display(a){
                id = Math.floor(Math.random() * 9999999999999999999);
                x="" 
                arr=scores[a],warr=credits[a]
                if(a==1) x="<td>"+tarray[arr.length-1]+"</td>"
                $("board"+a).innerHTML+="<tr id='tr"+a+id+"'><td>"+$("subjectName").value+"</td><td>"+arr[arr.length-1]+"</td><td>"+warr[arr.length-1]+"</td>"+x+"<td><input type='button' value='Delete' onclick='deleteThis(\"tr"+a+id+"\")'></td></tr>";
                refresh()
            }
            function sum(){
                $('tsum').innerHTML=("<td>Sum</td><td></td><td>"+creditTotal[0]+"</td><td>"+scoreTotal+"</td><td>Average:"+average+"</td>")
            }
            function deleteThis(m){
                var n, a=m[2];
                for(i=0;i<scores[a].length;i++){
                    if($("board"+a).getElementsByTagName('tr')[i].id==m) n=i;
                }
                scores[a].splice(n,1);credits[a].splice(n,1);if(a==1){tarray.splice(n,1);}
                $(m).remove();
                (scores[a].length==0)?clearInputs(a):updateTables(a);
            }
        </script>
    </body>
</html>
